(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const c={DATABASE_NAME:"KeyDb",OBJECT_STORE_NAME:"KeyObjectStore",VERSION:1,KEY_ID:1},l={name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-384",extractable:!1,keyUsages:["sign","verify"]};function p(){return window.crypto.subtle.generateKey({name:l.name,modulusLength:l.modulusLength,publicExponent:l.publicExponent,hash:l.hash},l.extractable,l.keyUsages)}function A(t,e){return window.crypto.subtle.sign({name:l.name,hash:l.hash},e,t)}function S(t,e,n){return window.crypto.subtle.verify({name:l.name,hash:l.hash},e,n,t)}function f(){const e=window.indexedDB.open(c.DATABASE_NAME,c.VERSION);return e.onupgradeneeded=function(){e.result.createObjectStore(c.OBJECT_STORE_NAME,{keyPath:"id"})},e}async function T(){return new Promise((t,e)=>{const n=f();n.onsuccess=function(){const s=n.result,u=s.transaction(c.OBJECT_STORE_NAME,"readwrite").objectStore(c.OBJECT_STORE_NAME).get(c.KEY_ID);u.onsuccess=async function(){try{const i=await b(u,s),a=await window.crypto.subtle.exportKey("jwk",i.publicKey);t(a)}catch(i){e(i)}}}})}async function m(t){return new Promise((e,n)=>{const s=f();s.onsuccess=function(){const o=s.result,i=o.transaction(c.OBJECT_STORE_NAME,"readwrite").objectStore(c.OBJECT_STORE_NAME).get(c.KEY_ID);i.onsuccess=async function(){try{const a=await b(i,o),d=await A(t,a.privateKey);e(d)}catch(a){n(a)}},i.onerror=async function(){n(i.error)}}})}async function b(t,e){var s;let n=(s=t.result)==null?void 0:s.keys;if(!n){if(n=await p(),p()===void 0)throw new Error("Could not create keys - Your browser does not support WebCrypto or you are running without SSL enabled.");e.transaction(c.OBJECT_STORE_NAME,"readwrite").objectStore(c.OBJECT_STORE_NAME).put({id:1,keys:n})}return n}function _(t,e){return new Promise((n,s)=>{const o=f();o.onsuccess=function(){const a=o.result.transaction(c.OBJECT_STORE_NAME,"readwrite").objectStore(c.OBJECT_STORE_NAME).get(c.KEY_ID);a.onsuccess=async function(){const d=a.result.keys.publicKey,y=await S(t,d,e);n(y)},a.onerror=async function(){s(a.error)}}})}function E(t){return B(g(t))}function O(t){const e=new Uint8Array(t);let n="";return e.forEach(s=>{n+=String.fromCharCode(s)}),btoa(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function K(t){const e=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),n=atob(e),s=n.length,o=new Uint8Array(s);for(let r=0;r<s;r++)o[r]=n.charCodeAt(r);return o.buffer}function x(t){t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");const e=atob(t);return new Uint8Array(e.split("").map(n=>n.charCodeAt(0)))}function g(t){const e=btoa(unescape(encodeURIComponent(t)));return x(e)}function B(t){return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}async function C(t){const e={alg:"RS384",typ:"JWT",kid:c.KEY_ID},n=Math.floor(Date.now()/1e3),o={iat:n,nbf:n,exp:n+300,...t},r=JSON.stringify(e),u=JSON.stringify(o),i=E(r),a=E(u),d=`${i}.${a}`,y=g(d),w=await m(y),h=O(w);return`${d}.${h}`}async function J(t){const[e,n,s]=t.split("."),o=g(`${e}.${n}`),r=K(s);return await _(o,r)}(async()=>{const t=await T();console.group("Public Key"),console.log(t),console.groupEnd();const e=await C({hello:"world"});console.group("JWT created and signed using Private Key"),console.log(e),console.groupEnd();const n=await J(e);console.group("Validate JWT using Public Key"),console.log(n?"JWT is valid":"JWT is invalid"),console.groupEnd()})();
